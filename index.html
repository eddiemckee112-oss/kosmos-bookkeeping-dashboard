<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kosmos — Home</title>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    :root{--bg:#fafafa;--card:#fff;--ink:#111;--muted:#6b7280;--border:#e5e7eb;--btn:#111;--btnH:#333;}
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--ink);margin:24px}
    h1{margin:0 0 10px;font-size:1.6rem}
    .grid{display:grid;gap:14px}
    @media(min-width:980px){.grid{grid-template-columns:1fr 1fr}}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px}
    .muted{color:var(--muted)}
    .kpis{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
    .kpi{background:#f9fafb;border:1px solid var(--border);border-radius:12px;padding:12px}
    .kpi span{display:block;color:var(--muted);font-size:12px}
    .kpi b{font-size:1.2rem}
    .links{display:flex;flex-wrap:wrap;gap:10px}
    a.btn{display:inline-block;padding:.6rem 1rem;border-radius:10px;border:1px solid #bbb;background:var(--btn);color:#fff;text-decoration:none}
    a.btn.secondary{background:#f7f7f7;color:#111}
    a.btn:hover{background:var(--btnH);color:#fff}
  </style>
</head>
<body>
  <h1>Kosmos Bookkeeping — Home</h1>
  <p class="muted" id="status">Connecting…</p>

  <div class="card">
    <h3>Quick Actions</h3>
    <div class="links" style="margin-top:8px">
      <a class="btn" href="dashboard.html">Open Dashboard</a>
      <a class="btn secondary" href="transactions.html">All Transactions</a>
      <a class="btn secondary" href="matched.html">Matched (audit)</a>
      <a class="btn secondary" href="unmatched-transactions.html">Unmatched Transactions</a>
      <a class="btn" href="receipts.html">Receipts Workbench (upload + match)</a>
    </div>
  </div>

  <div class="card" style="margin-top:14px">
    <h3>At a glance</h3>
    <div class="kpis" style="margin-top:10px">
      <div class="kpi"><span>Receipts</span><b id="kpiRc">—</b></div>
      <div class="kpi"><span>Transactions</span><b id="kpiTx">—</b></div>
      <div class="kpi"><span>Matches</span><b id="kpiMt">—</b></div>
      <div class="kpi"><span>Unmatched Receipts</span><b id="kpiRcUn">—</b></div>
    </div>
  </div>

  <script>
    const sb = supabase.createClient(
      "https://advihqhjjlxumgdlbwui.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFkdmlocWhqamx4dW1nZGxid3VpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEwMTg0MzIsImV4cCI6MjA3NjU5NDQzMn0.kVlaPQg2_o9DGJYv22Dgca7veok4drF6kgLPy2wPBeY"
    );
    const qs=id=>document.getElementById(id);

    async function count(table, col="*"){
      const {count,error}=await sb.from(table).select(col,{count:"exact",head:true});
      if(error) throw error; return count||0;
    }

    async function init(){
      try{
        qs("status").textContent="Loading…";
        const [rc, tx, mt] = await Promise.all([
          count("receipts"),
          count("transactions"),
          count("matches")
        ]);

        // unmatched receipts: use existing view if present
        let rcUn = 0;
        try {
          const {count} = await sb.from("v_unmatched_receipts").select("*",{count:"exact",head:true});
          rcUn = count||0;
        } catch { rcUn = Math.max(rc - mt, 0); }

        qs("kpiRc").textContent = rc;
        qs("kpiTx").textContent = tx;
        qs("kpiMt").textContent = mt;
        qs("kpiRcUn").textContent = rcUn;
        qs("status").textContent="Connected.";
      }catch(e){
        qs("status").textContent="Error: "+(e?.message||e);
      }
    }
    init();
  </script>
</body>
</html>
